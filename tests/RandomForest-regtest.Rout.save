
R Under development (unstable) (2012-09-25 r60811) -- "Unsuffered Consequences"
Copyright (C) 2012 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: i686-pc-linux-gnu (32-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> 
> set.seed(290875)
> library("party")
Loading required package: survival
Loading required package: splines
Loading required package: grid
Loading required package: modeltools
Loading required package: stats4
Loading required package: coin
Loading required package: mvtnorm
Loading required package: zoo

Attaching package: 'zoo'

The following object(s) are masked from 'package:base':

    as.Date, as.Date.numeric

Loading required package: sandwich
Loading required package: strucchange
Loading required package: vcd
Loading required package: MASS
Loading required package: colorspace
> if (!require("ipred"))
+     stop("cannot load package ipred")
Loading required package: ipred
Loading required package: rpart
Loading required package: mlbench
Loading required package: nnet
Loading required package: class
Loading required package: prodlim
Loading required package: KernSmooth
KernSmooth 2.23 loaded
Copyright M. P. Wand 1997-2009
> if (!require("coin"))
+     stop("cannot load package coin")
> 
> data("GlaucomaM", package = "ipred")
> rf <- cforest(Class ~ ., data = GlaucomaM, control = cforest_unbiased(ntree = 100))
> stopifnot(mean(GlaucomaM$Class != predict(rf)) < 
+           mean(GlaucomaM$Class != predict(rf, OOB = TRUE)))
> 
> data("GBSG2", package = "ipred")
> rfS <- cforest(Surv(time, cens) ~ ., data = GBSG2, control = cforest_unbiased(ntree = 100))
> treeresponse(rfS, newdata = GBSG2[1:2,])
$`1`
records   n.max n.start  events  median 0.95LCL 0.95UCL 
    227    1309    1309     706    1601    1601    1753 

$`2`
records   n.max n.start  events  median 0.95LCL 0.95UCL 
    241    1349    1349     616    1975    1807    2015 

> 
> ### give it a try, at least
> varimp(rf, pre1.0_0 = TRUE)
           ag            at            as            an            ai 
 1.111111e-03 -6.944444e-04  2.083333e-03  8.333333e-04  1.805556e-03 
          eag           eat           eas           ean           eai 
 0.000000e+00  5.555556e-04  2.777778e-04  2.777778e-03  5.555556e-04 
         abrg          abrt          abrs          abrn          abri 
 4.166667e-04  5.555556e-04  2.500000e-03  4.722222e-03  3.888889e-03 
          hic          mhcg          mhct          mhcs          mhcn 
 1.666667e-02  1.388889e-03 -2.775558e-19  4.166667e-03  1.666667e-03 
         mhci          phcg          phct          phcs          phcn 
 1.166667e-02  6.111111e-03 -2.777778e-04  4.166667e-04  4.027778e-03 
         phci           hvc          vbsg          vbst          vbss 
 9.583333e-03  1.944444e-03  2.222222e-03  8.333333e-04  1.111111e-03 
         vbsn          vbsi          vasg          vast          vass 
 0.000000e+00 -2.775558e-19  2.083333e-03  0.000000e+00  0.000000e+00 
         vasn          vasi          vbrg          vbrt          vbrs 
 0.000000e+00  2.500000e-03  8.333333e-04  1.388889e-04  1.250000e-03 
         vbrn          vbri          varg          vart          vars 
 1.111111e-03  6.805556e-03  2.847222e-02  1.111111e-03  1.972222e-02 
         varn          vari           mdg           mdt           mds 
 1.500000e-02  2.777778e-02 -1.388889e-04  2.777778e-04 -9.722222e-04 
          mdn           mdi           tmg           tmt           tms 
 1.111111e-03  6.944444e-04  1.611111e-02  0.000000e+00  9.722222e-03 
          tmn           tmi            mr           rnf          mdic 
-4.166667e-04  1.666667e-02  2.361111e-03  5.277778e-03  7.222222e-03 
          emd            mv 
 2.638889e-03 -8.333333e-04 
> 
> P <- proximity(rf)
> stopifnot(max(abs(P - t(P))) == 0)
> 
> P[1:10,1:10]
            2         43         25         65         70         16          6
2  1.00000000 0.11111111 0.74509804 0.24000000 0.03921569 0.10416667 0.57627119
43 0.11111111 1.00000000 0.05128205 0.02777778 0.16216216 0.29411765 0.07500000
25 0.74509804 0.05128205 1.00000000 0.37777778 0.04651163 0.11363636 0.60000000
65 0.24000000 0.02777778 0.37777778 1.00000000 0.05128205 0.02564103 0.51111111
70 0.03921569 0.16216216 0.04651163 0.05128205 1.00000000 0.22500000 0.02325581
16 0.10416667 0.29411765 0.11363636 0.02564103 0.22500000 1.00000000 0.02272727
6  0.57627119 0.07500000 0.60000000 0.51111111 0.02325581 0.02272727 1.00000000
5  0.51162791 0.03448276 0.73684211 0.62068966 0.08108108 0.05714286 0.51351351
12 0.37777778 0.03125000 0.48571429 0.61764706 0.07500000 0.06060606 0.47222222
63 0.48000000 0.05555556 0.64285714 0.36842105 0.08333333 0.12820513 0.48888889
            5         12         63
2  0.51162791 0.37777778 0.48000000
43 0.03448276 0.03125000 0.05555556
25 0.73684211 0.48571429 0.64285714
65 0.62068966 0.61764706 0.36842105
70 0.08108108 0.07500000 0.08333333
16 0.05714286 0.06060606 0.12820513
6  0.51351351 0.47222222 0.48888889
5  1.00000000 0.81250000 0.39393939
12 0.81250000 1.00000000 0.42857143
63 0.39393939 0.42857143 1.00000000
> 
> ### variable importances
> a <- cforest(Species ~ ., data = iris,
+              control = cforest_unbiased(mtry = 2, ntree = 10))
> varimp(a, pre1.0_0 = TRUE)
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
  0.08545455   0.00000000   0.29818182   0.21272727 
> varimp(a, conditional = TRUE)
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
  0.01272727   0.00000000   0.18545455   0.12000000 
> 
> airq <- subset(airquality, complete.cases(airquality))
> a <- cforest(Ozone ~ ., data = airq,
+              control = cforest_unbiased(mtry = 2, ntree = 10))
> varimp(a, pre1.0_0 = TRUE)   
   Solar.R       Wind       Temp      Month        Day 
 96.293668 376.925624 517.674245  -2.456052  27.627480 
> varimp(a, conditional = TRUE)
   Solar.R       Wind       Temp      Month        Day 
 65.978262 198.040511 341.221594   2.469503   8.671252 
> 
> a <- cforest(ME ~ ., data = mammoexp, control = cforest_classical(ntree = 10))
> varimp(a, pre1.0_0 = TRUE)   
       SYMPT           PB         HIST          BSE         DECT 
0.0330240459 0.0204430720 0.0118361515 0.0007600432 0.0023535057 
> varimp(a, conditional = TRUE)
      SYMPT          PB        HIST         BSE        DECT 
0.027567506 0.010011961 0.016523930 0.004138910 0.008821166 
> 
> stopifnot(all.equal(unique(sapply(a@weights, sum)), nrow(mammoexp)))
> 
> ### check user-defined weights
> nobs <- nrow(GlaucomaM)
> i <- rep(0.0, nobs)
> i[1:floor(.632 * nobs)] <- 1
> folds <- replicate(100, sample(i))
> rf2 <- cforest(Class ~ ., data = GlaucomaM, control = cforest_unbiased(ntree = 100), weights = folds)
> table(predict(rf), predict(rf2))
          
           glaucoma normal
  glaucoma       91      2
  normal          0    103
> 
> proc.time()
   user  system elapsed 
  8.160   0.212   8.378 
